<!DOCTYPE html>
<html lang="jp">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@500&display=swap" rel="stylesheet">
    <title>thatskyalbum</title>

    <style>
        html {
            font-family: 'Zen Maru Gothic', sans-serif;
            box-sizing: border-box;
        }

        body {
            margin: 0px;
            padding: 20px;
        }

        .content {
            display: flex;
            justify-content: center;
            /* background-color: lightskyblue; */
        }

        .album-page {
            display: none;
            /* background-color: aquamarine; */
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: center;
        }

        .album-list {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            /* background-color: lightpink; */
        }

        .comment {
            line-height: 20px;
        }

        .bubble {
            border-radius: 8px;
            padding: 7px 10px;
            /* background-color: teal; */
            color: white;
            display: inline-block;
            word-break: normal;
            word-wrap: break-word;
            margin: 3px 0px;
            align-self: flex-start;
        }

        .list-img {
            margin: 8px;
            align-self: center;
        }

        .list-img img {
            width: 300px;
            border-radius: 12px;
        }

        .list-img:hover {
            opacity: 0.7;
            cursor: pointer;
        }

        /* @media (min-width: 750px) {
            img {
                width: 49%;
            }
        } */

        /* .left-col {
            margin: 10px;
        } */

        .left-col img {
            width: 1100px;
            display: block;
        }

        .right-col {
            display: flex;
            flex-direction: column;
            flex-wrap: wrap;
            /* background-color: antiquewhite; */
            width: 520px;
            /* have width change depending on viewport size */
            box-sizing: border-box;
            padding: 15px;
        }

        .right-col-cmt {
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            /* background-color: yellow; */
            height: 70%;
            /* width: 70%; */
        }

        .page-comments {
            display: flex;
            flex-direction: column;
        }

        .page-details {
            /* background-color: lavender; */
            height: 30%;
            position: relative;
        }

        .exit-btn {
            position: absolute;
            right: 5px;
            top: 5px;
        }

        h1 {
            margin: 0px 0px 15px;
        }

        .entry-field input {
            height: 40px;
        }

        .id-invis {
            display: none;
        }
    </style>

    <!-- Reenable later:
    <link rel="icon" type="images/x-icon" href="./images/egg04.png">
    -->
</head>

<body>
    <h1>thatskyalbum</h1>

    <div class="content">
        <div class="album-list"></div>


    </div>

    <div class="album-page">
        <div class="left-col">
            <img class="page-img" alt="Large photo image">
        </div>

        <div class="right-col">
            <div class="page-details">
                <div class="exit-btn">
                    <input type="image" src="exit.png" onclick="closePage()">
                </div>
                <h1></h1>
                <hr>
                <p></p>
                <div class="id-invis"></div>
            </div>

            <div class="right-col-cmt">
                <div class="page-comments"></div>
                <div class="entry-field">
                    <form id="new-comment" onsubmit="addBubble(event)">
                        <input type="text" class="comment" maxlength="50" required>
                        <input type="submit" class="submit-btn" value="コメント">
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        const userComment = document.querySelector(".comment");
        const userSubmit = document.querySelector(".submit-btn");
        const outputArea = document.querySelector(".page-comments");
        let commentList = [];
        let regI;

        function addBubble(e) {
            e.preventDefault();
            const userInput = userComment.value;
            const newArea = document.createElement("div");
            const randomizer = Math.floor(Math.random() * 4);
            const postI = document.querySelector(".id-invis").textContent;
            
            console.log(postI)

            // Get reg-index if localStorage exists
            if (!localStorage.getItem("cmts")) {
                regI = 0;
            }
            else {
                commentList = JSON.parse(localStorage.getItem("cmts"));
            }

            // If obj data exists in commentList, get existing reg-index
            regI = cmtsData[postI]["reg-index"];


            // Visually remove oldest comment from list if total number of comments to show at a time exceeds 5
            if (outputArea.childElementCount == 5) outputArea.children[0].remove();

            newArea.classList.add("bubble");
            chngColor(newArea, randomizer);
            outputArea.append(newArea);
            newArea.textContent = `${userInput}`;

            // Store user input in localStorage
            // obj: {post-id: , cmt: , reg-index: }
            let newComment = { "post-id": postI, "cmt": userInput, "reg-index": regI++ }; // replace postI with appropriate variable name for photo index
            commentList.push(newComment);

            // Update comment list
            localStorage.setItem("cmts", JSON.stringify(commentList));

            console.log(regI);
        }

        function chngColor(areaToPaint, num) {
            switch (num) {
                case 0:
                    areaToPaint.style.backgroundColor = "#461959";
                    break;
                case 1:
                    areaToPaint.style.backgroundColor = "#7A316F";
                    break;
                case 2:
                    areaToPaint.style.backgroundColor = "#CD6688";
                    break;
                case 3:
                    areaToPaint.style.backgroundColor = "#EF6262";
            }
        }

        //  
    </script>

    <script src="images.js"></script>
</body>

</html>
